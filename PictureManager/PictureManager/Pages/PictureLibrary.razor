@page "/picture"
@using System.IO;
@using PictureManager.Model;
@using PictureManager.Pages.Components;
@using Common.Utility;
@inject HttpClient Http
@inject NavigationManager navigationManager
<link href="css/picture.css" rel="stylesheet" />

<h3 class="title">PictureLibrary</h3>

<div class="topbar">
    <div class="right">
        <select>
            <option value="0" selected="selected">全部</option>
            <option value="1">按姓名排序</option>
            <option value="1">按日期排序</option>
        </select>
    </div>
</div>
<div class="masonry">
    @if (_pictures != null)
    {
        foreach (var pic_path in _pictures)
        {
            <div class="item"><img src="@pic_path" style="width: 100%"></div>
        }
    }
</div>
@*<PagingComponent Page="1" PageSize="10" Count="10" Pages="10"/>*@
<PagingComponent @bind-Page="@_page" PageSize="@_pageSize" Count="@_count" HrefString="/picture" />


@code {


    private List<string> _pictures;
    private int _page = 1;
    private int _pageSize = 8;
    private int _count = 0;
    //private int _pages = 0;
    [Parameter]
    public int Page
    { set
        {
            _page = value;
        }
        get
        {
            return _page;
        }
    }

    protected override async Task OnInitializedAsync()
    {
        this._pictures = new List<string>();
        //this._pictures.Add("../testpics/秦风手机壳.png");
        //this._pictures.Add("../testpics/下载.jpg");
        var test = await Http.GetFromJsonAsync<ClientPictureModel>("api/Picture/GetPictures");

        this._pictures = test.result;
        this._count = 100;


        //string basePath = "D:\\private\\pictures";
        //List<string> pictures = LoadPicture(basePath);
        //foreach (var path in pictures)
        //{
        //    this._pictures.Add(@"https://localhost:44350/PersonalPicture" + path.Substring(path.IndexOf(basePath)));
        //}

    }

    protected override async Task OnParametersSetAsync()
    {
        if (!string.IsNullOrEmpty(navigationManager.QueryString("page")))
        {
            this.Page = int.Parse(navigationManager.QueryString("page"));
        }
    }

}
